var pSearchByImageSearchBox=function(){function k(){h=_ge("sb_form");_searchBoxForm=n.gfbc("b_searchboxForm");_searchBoxSubmit=_ge("sb_form_go");t=_ge("sbi_sb");f=_ge("sbi_form");tt=_ge("sbi_cl");w=_ge("sbi_g");a=_ge("sbi_gh");o=_ge("sbi_file");e=_ge("sbi_file_upload");r=_ge("sbi_p");i=_ge("sbi_ipt");var s=_ge("sbi_img");i&&(v=i.value,d(i),i=_ge("sbi_ipt"));e&&(d(e),e=_ge("sbi_file_upload"));s&&d(s);ai();t&&n.ga(t,"data-openiniframe")&&(c=typeof IFrameOverlay!="undefined"?IFrameOverlay:null,l=f?f.action:null);ri();ui();ti();ci();window.File&&window.FileReader&&window.FileList&&window.Blob||!o||(n.sd(o,u),n.sd(_ge("sbi_or"),u))}function at(){_ge("sbi_file_upload").click()}function ti(){t&&(ht=n.ga(t,"maxsize"),ct=n.ga(t,"quality"))}function ii(){var n=_ge("sbi_img_th"),r=sj_cook.get("_SBI","THPN"),t="",i,u,f;if(r&&r>0)for(i=1;i<=r;++i)t+=sj_cook.get("_SBI"+i,"TH");u=sj_cook.get("_SBIA","THW");f=sj_cook.get("_SBIB","THH");n&&(!n.src||n.src=="")&&(t&&t!=""&&(n.src="data:image/gif;base64,"+t),f&&u&&(n.width=u,n.height=f))}function p(){var f,u,o;if(r&&b&&(f=_ge("id_h"),f)){var t=f.getBoundingClientRect(),i=b,e=_ge("sb_th"),o=!1;e&&(u=e.getBoundingClientRect(),o=u.left<t.left&&u.left+u.width>t.left);t.left<i.left&&t.left+t.width>i.left||i.left<t.left&&i.left+i.width>t.left||o?(n.ac(r,y),ei()):n.rc(r,y)}}function ri(){if(h&&r){var i=null,u=_ge("sbi_st");u&&(i=u.value);it=_ge("sbi_bc");r.appendChild(it);r.setAttribute("data-tooltip",i);r.setAttribute("aria-label",i);n.rc(r,y);n.sv(r,ni);_ge("sa_con")&&(n.sl(t,"100px"),n.st(t,"55px"),n.sw(t,"560px"));_searchBoxSubmit&&_searchBoxSubmit.parentNode&&n.ga(r,"data-iconInSearchbox")?(n.ac(_searchBoxSubmit.parentNode,"in_sb"),n.ib(_searchBoxSubmit.parentNode,r,_searchBoxSubmit),fi()):h.appendChild(r);b=r.getBoundingClientRect();n.ac(r,y);n.sv(r,gt)}}function ui(){var i=_ge("sw_hdr")||_ge("b_header"),e=_ge("sbi_sb_ctn");i&&e&&t&&f&&t.parentNode!=r.parentNode&&(i.appendChild(t),n.sd(t,u))}function fi(){if(h&&_searchBoxSubmit&&_searchBoxSubmit.value){var n=sj_ce("div"),t=_searchBoxSubmit.value;n.setAttribute("id","sb_th");n.setAttribute("data-tooltip",t);n.setAttribute("aria-label",t);_searchBoxSubmit.parentNode&&_searchBoxSubmit.parentNode.nodeType==Node.ELEMENT_NODE&&(_searchBoxSubmit.parentNode.replaceChild(n,_searchBoxSubmit),n.appendChild(_searchBoxSubmit))}}function ei(){var n=_ge("sb_th");h&&_searchBoxSubmit&&n&&n.parentNode&&n.parentNode.nodeType==Node.ELEMENT_NODE&&(n.removeChild(_searchBoxSubmit),n.parentNode.replaceChild(_searchBoxSubmit,n))}function d(n){if(!sb_ie){try{n.value=""}catch(t){}try{n.parentNode.innerHTML=n.parentNode.innerHTML}catch(t){}}}function g(t){var i=_ge("sbi_sb_ct"),r=_ge("sbi_ld");i&&r&&(n.sd(i,t?u:""),n.sd(_ge("sbi_title"),t?u:""),n.sd(_ge("sbi_desc"),t?u:""),n.sd(_ge("sbi_sb_ipt"),t?u:""),n.ss(r,"visibility",t?"visible":""))}function vt(n){if(window.File&&window.FileReader&&window.FileList&&window.Blob&&n.target&&n.target.files&&n.target.files.length>0&&lt){var t=n.target.files[0],i=sb_gt();lt.convertImageFileToBase64(t,function(n,r){var u=sb_gt()-i;oi(t,n,r,u)},null,ht,ct)}}function oi(r,o,s,h){var w,d,v;if(o=o.replace("data:image/",""),w=o.indexOf(","),w>0&&(o=o.substr(w+1)),_ge("sbi_img").value=o,a&&r){var b=r,nt=b.size,tt=b.name,it=b.type,y=s.originalWidth,p=s.originalHeight,k=[];k.push(y,"+x+",p,"+%c2%b7+",parseInt(nt/1024),"+kB","+%c2%b7+",it.replace("image/",""));d=l?l:f.action;v=[];v.push(d.replace("%IMAGEURL%","").replace("%SBIPAGENAME%","sbiupload"));v.push("&sbifsz=",k.join(""));v.push("&sbifnm=",encodeURIComponent(tt));v.push("&thw=",y);v.push("&thh=",p);v.push("&ptime=",h);v.push("&dlen=",o.length);v.push("&expw=",y);v.push("&exph=",p);logPageClick("searchbyuploadimage","clickfileinput");pInstr.logEvent(null,"CI.ImageUpload",null,"SearchByImage",{DataLength:o.length,ImageProcessingTime:h,OriginalHeight:p,OriginalWidth:y,ResultHeight:s.resultHeight,ResultWidth:s.resultWidth},null);f.action=v.join("");c&&(e&&(e.value=""),f.action+="&mode=overlay",c.show(v.join(""),!0,null,!0),n.sd(t,u));i&&(i.value="",f.action+="#enterInsights");a.click();g(!0)}}function nt(){var e=_ge("sbi_ipt"),i="",o,s,r;return e&&(i=e.value),i!=""&&i!=v?si(i)==!1&&(o=_ge("sb_form_q"),s=_ge("sb_form_go"),o&&s)?(o.value=i,s.click(),!1):(r=l?l:f.action,e&&(r=r.replace("%IMAGEURL%","imgurl:"+encodeURIComponent(i)).replace("%SBIPAGENAME%","sbi")+"#enterInsights"),g(!0),logPageClick("searchbyimageurl","clicksearchbutton"),c?(e.value="",c.show(r,!0,"&mode=overlay"),n.sd(t,u)):(f.action=r,a.click()),!0):!1}function si(n){return/^(ht|f)tps?%3A%2F%2F[a-z0-9-\.]+\.[a-z]{2,4}\/?([^\s<>\#"\,\{\}\\|\\\^\[\]`]+)?$/.test(encodeURIComponent(n))}function hi(){t&&n.gs(t,"display")!=u&&(n.sd(t,u),logPageClick("closesearchbyimage","closesearchbox"))}function yt(n){for(var i=n.target||n.srcElement;i!=null;){if(i==tt)break;else{if(i==t)return;if(i==r){kt();return}}i=i.parentElement}hi()}function ci(){sj_be(_w,ut,li);sj_be(_d,s,yt);sj_be(w,s,nt);sj_be(e,rt,vt);sj_be(i,ft,wt);sj_be(i,et,bt);sj_be(i,ot,pt);sj_be(_w,"resize",p);o&&sj_be(o,s,at);sj_evt.bind(st,p)}function li(){sj_ue(_d,s,yt);sj_ue(w,s,nt);sj_ue(e,rt,vt);sj_ue(_w,ut,k);sj_ue(i,ft,wt);sj_ue(i,et,bt);sj_ue(i,ot,pt);sj_ue(_w,"resize",p);o&&sj_ue(o,s,at);sj_evt.unbind(st,p)}function pt(n){var n=n||window.event,t;return n?n&&n.keyCode==13?(t=sb_ie&&navigator&&navigator.userAgent&&(navigator.userAgent.indexOf("MSIE 8")>=0||navigator.userAgent.indexOf("MSIE 7")>=0),t||n.preventDefault(),nt(),!1):void 0:!1}function wt(){i.value==v&&(i.value="");n.rc(i,"sbi_hm")}function bt(){i.value==""&&(i.value=v,n.ac(i,"sbi_hm"))}function kt(){t&&(n.gs(t,"display")==u?(g(!1),n.sd(t,dt),_d.body.scrollTop=_d.documentElement.scrollTop=0,i.focus(),logPageClick("searchbyimage","opensearchbox")):(n.sd(t,u),logPageClick("searchbyimage","closesearchbox")))}function ai(){var n=f.action,t=window.location.href,i=n.replace("%REDIRECTURL%",encodeURIComponent(t));f.action=i}var t,f,h,tt,w,a,o,e,it,n=pMMUtils,r,i,v,b,c=null,l=null,s="click",rt="change",ut="unload",ft="focus",et="blur",ot="keypress",u="none",dt="block",gt="visible",ni="hidden",st="identityHeaderShown",y="hidden",ht,ct,lt=typeof ImageProcessor!="undefined"?ImageProcessor:null;return sj_be(_w,"load",k),{i:k,s:kt,c:ii}}()